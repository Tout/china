#!/usr/bin/python

import sys
import os
import argparse
from china_lib import unit
from china_lib import context

from china_lib.global_config import *

DEFAULT_COMMAND = 'create'

VALID_COMMANDS = { DEFAULT_COMMAND: unit.instantiate_units,
                   'add': unit.add_units }

parser = argparse.ArgumentParser(description='Manage china unit instances')

config_common_args(parser, VALID_COMMANDS, DEFAULT_COMMAND)

parser.add_argument('-l', '--role',
                    help='the role of the unit (default is the unit name)')
parser.add_argument('-x', '--number',
                    help='how many instances to create',
                    default=1)

args = parser.parse_args()

if args.noop:
    os.environ['CHINA_DEBUG'] = "1"

ctx = context.ChinaContext(args.blueprints, args.command, VALID_COMMANDS)
ctx.set_region(args.region)
ctx.set_environment(args.environment)

# OK, we have everything we need, let's roll...
VALID_COMMANDS[args.command](ctx, args.unit, args.role, args.number)

sys.exit(0)
